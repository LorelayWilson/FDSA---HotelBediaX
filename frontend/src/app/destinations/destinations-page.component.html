<div class="layout">
  <app-alert 
    [show]="alert().show" 
    [type]="alert().type" 
    [message]="alert().message"
    (dismissed)="onAlertDismissed()">
  </app-alert>

  <aside class="sidebar">
    <h3>Filtros</h3>
    <input 
      type="text" 
      placeholder="Buscar..." 
      [(ngModel)]="searchTerm"
      (keyup.enter)="onSearch()" />
    <select [(ngModel)]="countryCode" (change)="onFilterChange()">
      <option value="">Todos los países</option>
      @for (country of countries(); track country) {
        <option [value]="country">{{ country }}</option>
      }
    </select>
    <select [(ngModel)]="type" (change)="onFilterChange()">
      <option value="">Todos los tipos</option>
      @for (destType of destinationTypes(); track destType) {
        <option [value]="destType">{{ getTypeLabel(destType) }}</option>
      }
    </select>
  </aside>

  <section class="content">
    <h2>Destinos Turísticos</h2>
    
    <app-loading [isLoading]="loading()"></app-loading>

    <div class="actions">
      <app-button variant="primary" (clicked)="onCreate()">Crear</app-button>
      <app-button variant="secondary" [disabled]="selectedId() === null" (clicked)="onEdit()">Editar</app-button>
      <app-button variant="danger" [disabled]="selectedId() === null" (clicked)="onRemove()">Eliminar</app-button>
    </div>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Descripción</th>
          <th>País</th>
          <th>Tipo</th>
          <th>Modificado</th>
        </tr>
      </thead>
      <tbody>
        @for (destination of destinations(); track destination.id) {
          <tr (click)="selectRow(destination.id)" [class.selected]="selectedId() === destination.id">
            <td>{{ destination.id }}</td>
            <td>{{ destination.name }}</td>
            <td>{{ destination.description }}</td>
            <td>{{ destination.countryCode }}</td>
            <td>{{ getTypeLabel(destination.type) }}</td>
            <td>{{ destination.lastModif | date:'dd/MM/yyyy' }}</td>
          </tr>
        }
      </tbody>
    </table>

    <div class="pagination">
      <app-button variant="secondary" [disabled]="!canGoToPreviousPage()" (clicked)="changePage(-1)">Anterior</app-button>
      <span>Página {{ filter().page || 1 }} | Total: {{ totalCount() }}</span>
      <app-button variant="secondary" [disabled]="!canGoToNextPage()" (clicked)="changePage(1)">Siguiente</app-button>
    </div>
  </section>
</div>


